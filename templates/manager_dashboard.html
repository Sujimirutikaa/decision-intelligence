{% extends "base.html" %}

{% block title %}Manager Dashboard{% endblock %}

{% block content %}
<div class="dashboard-container">
    <nav class="navbar">
        <div class="navbar-brand">
            Decision Intelligence
            <span class="role-badge manager">MANAGER</span>
        </div>
        <div class="navbar-nav">
            <a href="{{ url_for('manager_dashboard') }}" class="nav-link">Dashboard</a>
            <a href="{{ url_for('manager_decisions') }}" class="nav-link">Decisions</a>
            <a href="{{ url_for('manager_analytics') }}" class="nav-link">Analytics</a>
            <a href="{{ url_for('logout') }}" class="logout-btn">Logout</a>
        </div>
    </nav>
    
    <div class="dashboard-header">
        <h1>Manager Dashboard</h1>
        <p>Welcome back, {{ current_user.username }}!</p>
    </div>
    
    <div class="stats-grid">
        <div class="stat-card manager">
            <div class="icon">‚è∞</div>
            <div class="number">{{ pending }}</div>
            <div class="label">Pending Review</div>
        </div>
        <div class="stat-card manager">
            <div class="icon">‚úì</div>
            <div class="number">{{ reviewed }}</div>
            <div class="label">Reviewed</div>
        </div>
        <div class="stat-card manager">
            <div class="icon">üí∞</div>
            <div class="number">${{ "{:,.0f}".format(total_debt) }}</div>
            <div class="label">Decision Debt</div>
        </div>
        <div class="stat-card manager">
            <div class="icon">üìä</div>
            <div class="number">{{ categories }}</div>
            <div class="label">Categories</div>
        </div>
    </div>
    
    <div class="content-card">
        <h2>Recent Pending Decisions</h2>
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Employee</th>
                        <th>Title</th>
                        <th>Category</th>
                        <th>Impact</th>
                        <th>Created</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for decision in pending_decisions %}
                    <tr>
                        <td>{{ decision.creator.username }}</td>
                        <td>{{ decision.title }}</td>
                        <td><span class="badge badge-pending">{{ decision.category }}</span></td>
                        <td>${{ "{:,.0f}".format(decision.financial_impact) }}</td>
                        <td>{{ decision.created_at.strftime('%Y-%m-%d') }}</td>
                        <td>
                            <a href="{{ url_for('manager_review', decision_id=decision.id) }}" class="btn btn-manager btn-sm">Review</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    
    <div class="charts-grid">
        <div class="chart-container">
            <h3>Decisions by Category</h3>
            <canvas id="categoryChart"></canvas>
        </div>
        <div class="chart-container">
            <h3>Outcome Distribution</h3>
            <canvas id="outcomeChart"></canvas>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    fetch('/api/decisions-by-category')
        .then(res => res.json())
        .then(data => {
            new Chart(document.getElementById('categoryChart'), {
                type: 'bar',
                data: {
                    labels: data.categories,
                    datasets: [{
                        label: 'Decisions',
                        data: data.counts,
                        backgroundColor: '#2563eb'
                    }]
                }
            });
        });
    
    fetch('/api/outcome-distribution')
        .then(res => res.json())
        .then(data => {
            new Chart(document.getElementById('outcomeChart'), {
                type: 'doughnut',
                data: {
                    labels: data.outcomes,
                    datasets: [{
                        data: data.counts,
                        backgroundColor: ['#22c55e', '#ef4444', '#f59e0b']
                    }]
                }
            });
        });
</script>
{% endblock %}